<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNO AI+ | Unified Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap');
        :root { --uno-yellow: #fbbf24; --uno-bg: #050505; }
        body.light-mode { --uno-bg: #fafafa; }
        body { background-color: var(--uno-bg); color: #fff; font-family: 'Outfit', sans-serif; transition: 0.5s; margin: 0; overflow: hidden; }
        body.light-mode { color: #1a1a1a; }
        .glass { background: rgba(15, 15, 15, 0.7); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(251, 191, 36, 0.1); }
        .light-mode .glass { background: rgba(255, 255, 255, 0.8); }
        .msg-user { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000; padding: 12px 20px; border-radius: 20px 20px 4px 20px; max-width: 85%; align-self: flex-end; }
        .msg-ai { background: rgba(251, 191, 36, 0.05); border: 1px solid rgba(251, 191, 36, 0.1); padding: 18px; border-radius: 20px 20px 20px 4px; width: 100%; max-width: 90%; }
        #history-sidebar { position: fixed; left: -320px; top: 0; bottom: 0; width: 300px; z-index: 100; transition: 0.4s; background: #0f0f0f; border-right: 1px solid rgba(251, 191, 36, 0.1); }
        #history-sidebar.open { left: 0; }
        .cursor-blink { display: inline-block; width: 2px; height: 15px; background: #fbbf24; animation: blink 0.8s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body class="light-mode">

    <div id="intro-overlay" class="fixed inset-0 bg-black z-[9999] flex flex-col items-center justify-center transition-opacity duration-1000">
        <div class="w-20 h-20 bg-yellow-500 rounded-3xl flex items-center justify-center shadow-2xl">
            <img src="https://img.icons8.com/fluency/96/artificial-intelligence.png" class="w-12">
        </div>
        <h2 class="text-white mt-6 font-bold text-2xl tracking-widest">UNO AI+</h2>
    </div>

    <div id="history-sidebar" class="p-6">
        <h3 class="text-xs font-bold uppercase text-yellow-600 mb-6">Chat Archive</h3>
        <div id="sidebar-list" class="space-y-2"></div>
    </div>

    <main class="flex flex-col h-screen">
        <header class="h-20 flex items-center justify-between px-6 glass">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="text-yellow-600 text-lg"><i class="fas fa-bars"></i></button>
                <h1 class="font-bold text-xl">UNO <span class="text-yellow-600">AI+</span></h1>
            </div>
            <div class="flex gap-4">
                <button onclick="toggleTheme()" class="w-10 h-10 rounded-xl bg-yellow-500/10 text-yellow-600"><i class="fas fa-moon"></i></button>
                <button onclick="newSession()" class="w-10 h-10 rounded-xl bg-yellow-500/10 text-yellow-600"><i class="fas fa-plus"></i></button>
            </div>
        </header>

        <div id="chat-scroller" class="flex-1 overflow-y-auto p-6 scroll-smooth">
            <div id="empty-state" class="h-full flex flex-col items-center justify-center opacity-30">
                <img src="https://img.icons8.com/fluency/96/artificial-intelligence.png" class="w-16 mb-4 grayscale">
                <p class="font-medium">Ready for your request...</p>
            </div>
            <div id="chat-display" class="max-w-3xl mx-auto flex flex-col gap-6"></div>
        </div>

        <div class="p-6">
            <div class="max-w-3xl mx-auto glass rounded-3xl p-3 border border-yellow-500/20 shadow-xl">
                <div id="file-preview-area" class="hidden flex gap-2 mb-2 p-2 bg-yellow-500/5 rounded-xl"></div>
                <div class="flex items-end gap-3">
                    <button onclick="document.getElementById('file-input').click()" class="w-10 h-10 flex items-center justify-center text-yellow-600 hover:bg-yellow-500/10 rounded-xl"><i class="fas fa-paperclip"></i></button>
                    <textarea id="user-input" rows="1" placeholder="Type here..." class="flex-1 bg-transparent border-none focus:outline-none py-2 resize-none text-sm"></textarea>
                    <button onclick="processStream()" id="send-btn" class="w-12 h-12 bg-yellow-500 hover:bg-yellow-400 rounded-2xl flex items-center justify-center text-black shadow-lg transition-transform active:scale-95">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
            <input type="file" id="file-input" class="hidden" accept="image/*">
        </div>
    </main>

    <script>
        // --- 1. YOUR API KEY GOES HERE ---
        const API_KEY = "vck_2elhezuvjzFTiMM0YXFfuWrPjnLLvQbdoXKG6o23xZW52PCxvN0gSC8t"; 
        
        // --- 2. THE CORE LOGIC (STABILIZED) ---
        async function processStream() {
            const input = document.getElementById('user-input');
            const prompt = input.value.trim();
            if (!prompt) return;

            // Clear preview & input
            const previewArea = document.getElementById('file-preview-area');
            const attachedImg = previewArea.querySelector('img')?.src || null;
            document.getElementById('empty-state').style.display = 'none';
            input.value = '';
            
            appendMessage('user', prompt);
            const aiMsgBox = appendMessage('ai', '<span class="cursor-blink"></span>');
            const textContent = aiMsgBox.querySelector('.prose-container');

            try {
                // Detect if it's an Image (Nano Banana) or Chat request
                const isImageTask = attachedImg || prompt.toLowerCase().includes("generate") || prompt.toLowerCase().includes("draw");

                // We use the direct Fetch API for maximum stability in local files
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt },
                                attachedImg ? { inline_data: { mime_type: "image/jpeg", data: attachedImg.split(',')[1] } } : null
                            ].filter(Boolean)
                        }]
                    })
                });

                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content.parts[0].text) {
                    const resultText = data.candidates[0].content.parts[0].text;
                    textContent.innerHTML = marked.parse(resultText);
                } else {
                    throw new Error("Empty response");
                }

            } catch (err) {
                textContent.innerHTML = `<span class="text-red-500 font-bold"><i class="fas fa-exclamation-circle"></i> Connection Error.</span><br><small>Ensure your API key is correct and you have an internet connection.</small>`;
                console.error(err);
            }
        }

        // --- UI HELPERS (No change to your interface) ---
        function appendMessage(role, content) {
            const display = document.getElementById('chat-display');
            const wrap = document.createElement('div');
            wrap.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            wrap.innerHTML = role === 'user' 
                ? `<div class="msg-user">${content}</div>`
                : `<div class="msg-ai flex gap-4">
                    <img src="https://img.icons8.com/fluency/48/artificial-intelligence.png" class="w-8 h-8 rounded-lg">
                    <div class="prose-container text-sm leading-relaxed">${content}</div>
                   </div>`;
            display.appendChild(wrap);
            document.getElementById('chat-scroller').scrollTop = document.getElementById('chat-scroller').scrollHeight;
            return wrap;
        }

        function toggleTheme() { document.body.classList.toggle('light-mode'); }
        function toggleSidebar() { document.getElementById('history-sidebar').classList.toggle('open'); }
        function newSession() { document.getElementById('chat-display').innerHTML = ''; document.getElementById('empty-state').style.display = 'flex'; }

        // File Handler
        document.getElementById('file-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (re) => {
                const area = document.getElementById('file-preview-area');
                area.innerHTML = `<div class="relative"><img src="${re.target.result}" class="w-12 h-12 rounded-lg object-cover border-2 border-yellow-500"></div>`;
                area.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        });

        // Remove Intro
        setTimeout(() => {
            const intro = document.getElementById('intro-overlay');
            intro.style.opacity = '0';
            setTimeout(() => intro.remove(), 1000);
        }, 2000);

        // Enter key to send
        document.getElementById('user-input').addEventListener('keydown', (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); processStream(); } });
    </script>
</body>
</html>